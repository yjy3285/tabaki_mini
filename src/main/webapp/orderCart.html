<!DOCTYPE html>
<html>
<head>
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootswatch@4.5.2/dist/sandstone/bootstrap.min.css">
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
	<meta charset="UTF-8">
	<title>장바구니</title>
	<style>
		body, h1, h2, h3, h4, h5, h6, table, pre, xmp, plaintext, listing, input, textarea, select, a {
			font-family: 'Pretendard-Regular', 'Noto Sans KR', sans-serif;
		}

		#contentWrapper {
			width: 1200px;
			padding: 40px 0;
			position: relative;
			margin-right: auto;
		    margin-left: auto;
			border-top: 1px solid #e7e8e9;
			min-height: calc(100vh - 579px);
		}

		#page_top {
			text-align: center;
			margin-bottom: 30px;
			color: white;
			-webkit-text-stroke: 1px #c85855;
			font-size: 2.5em;
		}

		#cartWrap {
			padding: 40px;
			border-radius: 8px;
			box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
		}

		.table-warning {
			margin-bottom: 40px;
		}
		
		tfoot td {
		    margin-top: 20px;
		    margin-bottom: 20px;
		}

		.table-light {
			margin-right: auto;
		    margin-left: auto;
		}

		.basket_totalprice {
			display: flex;
			align-items: center;
			justify-content: flex-end;
			margin-top: 40px;
			margin-bottom: 40px;
			border: #DDDDDD DASHED 1PX;
		}

		.totalprice_img {
		    width: 100px;
		    height: 50px;
		    margin-right: 20px;
		    display: flex;
		    align-items: center; /* 수직 중앙 정렬 */
		}

		.totalprice_txt strong {
			font-size: 1.5em;
			color: #c85855;
		}

		.cartNotice .dot_list {
			list-style-type: disc;
			padding-left: 40px;
			color: #8E8C84;
		}

		#cartTable {
			width: 100%;
			text-align: center;
		}

		table {
			width: 100%;
			margin: 0 auto;
		}
		
		tbody {
			padding-top: 15px;
			padding-bottom: 15px;
		}
		
		.tb_center {
			height: 40px;
			display: flex;
			align-items: center;
			justify-content: center;
		}

		.btns_order {
			text-align: center;
			margin-top: 40px;
		}

		.btns_order button {
			margin: 0 10px;
		}

		.quantity-control {
			display: flex;
			align-items: center;
			justify-content: center;
		}

		.quantity-control button {
			background-color: #ddd;
			border: none;
			padding: 5px 10px;
			cursor: pointer;
		}

		.quantity-control input {
			text-align: center;
			width: 40px;
			border: none;
		}

		.quantity-control button:hover {
			background-color: #ccc;
		}
	</style>
</head>
<body>
	<!-- 장바구니 -->
	<div id="contentWrapper">
		<div id="contentWrap">
			<div id="content">
				<!-- 장바구니 타이틀 -->
				<h1 id="page_top">장바구니</h1>
				
				<!-- 장바구니 카드 -->
				<div id="cartWrap">
					<!-- 장바구니 테이블 -->
					<div id="cartTable">
						<table>
							<colgroup>
								<col width="5%">
								<col width="25%">
								<col width="30%">
								<col width="15%">
								<col width="15%">
								<col width="10%">
							</colgroup>
							<thead>
								<tr class="table-warning">
									<th scope="row"><div class="tb_check">선택</div></th>
									<th scope="row"><div class="tb_img">사진</div></th>
									<th scope="row"><div class="tb_title">상품명</div></th>
									<th scope="row"><div class="tb_quantity">수량</div></th>
									<th scope="row"><div class="tb_price">결제예정가</div></th>
									<th scope="row"><div class="tb_delete">선택</div></th>
								</tr>
							</thead>
							<tbody>
								<!-- 동적으로 상품을 추가할 부분 -->
							</tbody>
							<tfoot>
								<tr id="emptyCartMessage">
									<td colspan="6">
										<div>장바구니에 담긴 상품이 없습니다</div>
									</td>
								</tr>
							</tfoot>
						</table>
					</div>
					<!-- table-fill-prd -->
					<div class="basket_totalprice">
						<div class="totalprice_img">
							총 구매 금액
						</div>
						<div class="totalprice_txt">
							<strong></strong>
						</div>
					</div>
					<div class="cartNotice">
						<div class="flt">
							<ul class="dot_list">
								<li>장바구니의 상품별 할인가는 "미리 계산된 가격" 입니다</li>
								<li>주문서의 쿠폰변경시 실제 가격은 달라질 수 있습니다</li>
								<li>상품 한개당 최대 구매가능 개수는 10개입니다</li>
							</ul>
						</div>
					</div>
					<!-- 주문버튼 -->
					<div class="btns_order">
						<button type="button" class="btn btn-outline-secondary">선택삭제</button>
						<button type="button" class="btn btn-outline-secondary">계속 쇼핑하기</button>
						<button type="button" class="btn btn-outline-secondary">장바구니 비우기</button>
						<button type="button" class="btn btn-outline-danger">선택상품 주문하기</button>
					</div>						
				</div>
				<!-- cartWrap -->
			</div>
			<!-- page_body -->
		</div>
		<!-- contentWrap -->
	</div>
	
	<!-- 장바구니 내용 동적 구현 -->
	<script>
	// 로컬 스토리지에서 장바구니 데이터를 불러와서 렌더링
	function renderCart() {
	    let cartItems = JSON.parse(localStorage.getItem('cartItems')) || [];
	    const tableBody = document.querySelector('#cartTable tbody');
	    tableBody.innerHTML = ''; // 기존 내용을 초기화

	    const emptyCartMessage = document.querySelector('#emptyCartMessage');

	    if (cartItems.length === 0) {
	        emptyCartMessage.style.display = 'table-row';
	    } else {
	        emptyCartMessage.style.display = 'none';
	        cartItems.forEach((item, index) => {
	            const row = document.createElement('tr');
	            row.classList.add('table-light');
	            row.innerHTML = `
	                <td class="tb_check"><input type="checkbox" name="item_check_${index}" checked></td>
	                <td class="tb_img"><img src="${item.img}" alt="${item.title}" style="width: 50px; height: 50px;"></td>
	                <td class="tb_title">${item.title}</td>
	                <td class="tb_quantity">
	                    <div class="quantity-control">
	                        <button onclick="updateQuantity(${index}, ${item.quantity} - 1)">-</button>
	                        <input type="number" value="${item.quantity}" min="1" max="10" readonly>
	                        <button onclick="updateQuantity(${index}, ${item.quantity} + 1)">+</button>
	                    </div>
	                </td>
	                <td class="tb_price">${item.price}</td>
	                <td class="tb_delete"><button class="btn btn-danger btn-sm" onclick="removeFromCart(${index})">삭제</button></td>
	            `;
	            tableBody.appendChild(row);
	        });
	    }

	    // 장바구니 총 구매 금액 업데이트
	    updateTotalPrice();
	}

	// 장바구니에서 상품 제거 함수
	function removeFromCart(index) {
	    let cartItems = JSON.parse(localStorage.getItem('cartItems')) || [];
	    cartItems.splice(index, 1);
	    localStorage.setItem('cartItems', JSON.stringify(cartItems));
	    renderCart();
	}

	// 수량 변경 함수
	function updateQuantity(index, newQuantity) {
	    let cartItems = JSON.parse(localStorage.getItem('cartItems')) || [];
	    if (newQuantity < 1) newQuantity = 1;
	    if (newQuantity > 10) newQuantity = 10; // 최대 수량을 10으로 제한
	    cartItems[index].quantity = parseInt(newQuantity, 10);
	    localStorage.setItem('cartItems', JSON.stringify(cartItems));
	    renderCart();
	}

	// 장바구니 총 구매 금액을 계산하는 함수
	function updateTotalPrice() {
	    let cartItems = JSON.parse(localStorage.getItem('cartItems')) || [];
	    const totalPriceElement = document.querySelector('.totalprice_txt strong');
	    const totalPrice = cartItems.reduce((acc, item) => {
	        const price = parseInt(item.price.replace(/[^0-9]/g, ''), 10); // 가격에서 숫자만 추출
	        return acc + (price * item.quantity);
	    }, 0);
	    totalPriceElement.textContent = `${totalPrice.toLocaleString()}원`;
	}

	// 선택된 상품 삭제
	function deleteSelectedItems() {
	    let cartItems = JSON.parse(localStorage.getItem('cartItems')) || [];
	    const checkboxes = document.querySelectorAll('#cartTable tbody input[type="checkbox"]');
	    const newCartItems = cartItems.filter((item, index) => !checkboxes[index].checked);
	    localStorage.setItem('cartItems', JSON.stringify(newCartItems));
	    renderCart();
	}

	// 장바구니 비우기
	function clearCart() {
	    localStorage.removeItem('cartItems');
	    renderCart();
	}

	// 선택된 상품 주문
	function orderSelectedItems() {
	    let cartItems = JSON.parse(localStorage.getItem('cartItems')) || [];
	    const checkboxes = document.querySelectorAll('#cartTable tbody input[type="checkbox"]');
	    const selectedItems = cartItems.filter((item, index) => checkboxes[index].checked);
	    
	    if (selectedItems.length > 0) {
	        // 여기서 선택된 상품을 주문하는 로직을 추가
	        // 예시: 주문 페이지로 이동
	        localStorage.setItem('selectedItems', JSON.stringify(selectedItems));
	        window.location.href = '/order-page'; // 주문 페이지로 이동하는 경로를 지정
	    } else {
	        alert('주문할 상품을 선택해주세요.');
	    }
	}

	// 페이지가 로드되면 장바구니를 초기화 및 렌더링
	document.addEventListener('DOMContentLoaded', function() {
	    const tableBody = document.querySelector('#cartTable tbody');
	    if (!tableBody) {
	        const newTbody = document.createElement('tbody');
	        document.querySelector('#cartTable').appendChild(newTbody);
	    }
	    renderCart();

	    // 버튼에 이벤트 핸들러 추가
	    document.querySelector('.btns_order .btn-outline-secondary:nth-child(1)').addEventListener('click', deleteSelectedItems);
	    document.querySelector('.btns_order .btn-outline-secondary:nth-child(2)').addEventListener('click', function() {
	        window.history.back(); // 직전 페이지로 돌아감
	    });
	    document.querySelector('.btns_order .btn-outline-secondary:nth-child(3)').addEventListener('click', clearCart);
	    document.querySelector('.btns_order .btn-outline-danger').addEventListener('click', orderSelectedItems);
	});
</script>
</body>
</html>
